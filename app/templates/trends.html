{% extends "base.html" %}

{% block content %}
<h2>Trends (Weight & BMI) — Last {{ n }} records</h2>

<p>
    <a href="/trends?n=7">{% if n == 7 %}<strong>Last 7</strong>{% else %}Last 7{% endif %}</a>
    |
    <a href="/trends?n=30">{% if n == 30 %}<strong>Last 30</strong>{% else %}Last 30{% endif %}</a>
</p>

{% if not records %}
<p>No data yet. Please add some records in "Record Today".</p>
{% else %}

<div id="trend-chart" style="width: 100%; height: 400px;"></div>

<!-- 引入 ECharts CDN -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<script>
// 把后端传来的数据变成 JS 数组
const dates = [
    {% for r in records %}
        "{{ r.date }}"{% if not loop.last %}, {% endif %}
    {% endfor %}
];

const weights = [
    {% for r in records %}
        {{ "%.1f"|format(r.weight_kg) }}{% if not loop.last %}, {% endif %}
    {% endfor %}
];

const bmis = [
    {% for r in records %}
        {% if r.bmi is not none %}
            {{ "%.1f"|format(r.bmi) }}
        {% else %}
            null
        {% endif %}
        {% if not loop.last %}, {% endif %}
    {% endfor %}
];

const chartDom = document.getElementById('trend-chart');
const myChart = echarts.init(chartDom);

const option = {
    tooltip: { trigger: 'axis' },
    legend: { data: ['Weight (kg)', 'BMI'] },
    xAxis: {
        type: 'category',
        data: dates
    },
    yAxis: [
        {
            type: 'value',
            name: 'Weight (kg)'
        },
        {
            type: 'value',
            name: 'BMI'
        }
    ],
    series: [
        {
            name: 'Weight (kg)',
            type: 'line',
            smooth: true,
            yAxisIndex: 0,
            data: weights
        },
        {
            name: 'BMI',
            type: 'line',
            smooth: true,
            yAxisIndex: 1,
            data: bmis
        }
    ]
};

myChart.setOption(option);
</script>

{% endif %}
{% endblock %}
